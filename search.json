[
  {
    "objectID": "log-reg.html",
    "href": "log-reg.html",
    "title": "Logistisk regression",
    "section": "",
    "text": "I det følgende skal vi se på logistisk regression. Måske har du allerede hørt begrebet logistisk regression ME: Eller du har måske hørt begrebet \"logistisk\"   i gymnasieundervisningen i forbindelse med logistisk vækst. Dette er en anden type af logistisk regression end den, der behandles i denne note. I slutningen af noten vil vi dog se et eksempel, hvor der alligevel er en sammenhæng mellem logistisk regression og logistisk vækst.\nLogistisk regression, i den betydning vi kigger på i denne note, bruges, når man gerne vil modellere, hvordan en sandsynlighed afhænger af en anden variabel. Som et eksempel forestiller vi os, at vi er interesserede i, hvordan sandsynligheden for at lide af hjerte-kar-sygdom afhænger af det systoliske blodtryk.\nVi vil kigge på et datasæt bestående af 2000 mennesker, som har fået målt deres blodtryk. Desuden har de fået undersøgt, om de lider af hjerte-kar-sygdom. Datasættet er fiktivt, men det er lavet til at ligne virkelige data1. Vi kalder blodtrykket for \\(x\\), mens vi lader \\(y\\) være en variabel, der er \\(1\\) hvis personen lider af hjertekarsygdom og \\(0\\) ellers. På figur 1 har vi tegnet samhørende \\(x\\)- og \\(y\\)-værdier ind i et koordinatsystem for de første 200 personer i datasættet.\n1 De fleste mennesker har et systolisk blodtryk mellem 100 og 180 mmHg. I datasættet har vi genereret en masse mennesker med ekstremt højt eller lavt blodtryk for illustrationens skyld, selv om det er urealistisk i praksis.\n\n\n\n\n\n\n\nFigur 1: Her ses et plot af data med blodtryk på \\(x\\)-aksen og sygdomsstatus på \\(y\\)-aksen.\n\n\n\n\n\nDet ses på figur 1, at der er flest personer med \\(y\\)-værdien 0, altså raske personer, blandt folk med lavt blodtryk, mens der er flest med \\(y\\)-værdien 1, svarende til syge, blandt folk med højt blodtryk. Men ved de fleste blodtryksværdier er der både syge og raske, og det er svært at få et præcist overblik ud fra figuren. Så hvordan kan man beskrive sammenhængen mellem \\(x\\) og \\(y\\)? I stedet for at se direkte på sammenhængen mellem \\(x\\) og \\(y\\), vil vi se på hvordan sandsynligheden for hjerte-kar-sygdom (\\(y=1\\)) afhænger af blodtrykkket. Vi vil betragte denne sandsynlighed som en funktion \\(p(x)\\), hvor funktionsværdien afhænger af blodtrykket \\(x\\). Vi ser nu på, hvordan man kan modellere denne funktion.\nFor at få en idé om, hvordan \\(p(x)\\) kunne se ud, kigger vi på datasættet fra før. Vi inddeler nu blodtrykket i intervaller af længde 25 og tæller op, hvor mange syge og raske der er inden for hvert interval. tabel gøres lidt pænere\n\n\n\nTabel 1: Tabel over syge og raske inden for forskellige blodtryksintervaller\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBlodtryk\n]75,100]\n]100,125]\n]125,150]\n]150,175]\n]175,200]\n]200,225]\n]225,250]\n]250,275]\n]275,300]\n\n\n\n\nRask\n173\n194\n145\n156\n98\n57\n47\n25\n19\n\n\nSyg\n24\n42\n62\n100\n132\n135\n178\n203\n210\n\n\nAndel syge\n0.122\n0.178\n0.300\n0.391\n0.574\n0.703\n0.791\n0.890\n0.917\n\n\n\n\n\n\nDesuden har vi beregnet, hvor stor en andel af patienterne inden for hvert interval, der lider af hjerte-kar-sygdom. Dette bruges som et estimat for sandsynligheden for hjerte-kar-sygdom i den gruppe. For eksempel er der 194 raske og 42 syge personer med et blodtryk i intervallet \\(]100,125]\\). Sammenlagt er der \\(194+42=236\\) personer i dette interval. Andelen af syge i denne gruppe er derfor \\[\n\\frac{42}{236} \\approx 0.178.\n\\] På figur 2 har vi tegnet disse andele ind i et koordinatsystem. For hvert blodtryksinterval er midtpunktet for intervallet indtegnet som \\(x\\)-værdien, og andelen af syge er indtegnet som den tilhørende \\(y\\)-værdi.\nME: For meget luft om figur\n\n\n\n\n\n\n\n\nFigur 2: Andel syge inden for hvert blodtryksinterval.\n\n\n\n\n\nUmiddelbart kunne det være fristende at lave lineær regression. Vi forestiller os altså en forskrift \\[\n    p(x) = ax + b.\n\\] På figur 3 har vi indtegnet den bedste rette linje i figur 2.\n\n\n\n\n\n\n\n\nFigur 3: Grafen for p(x) tilnærmet med en ret linje.\n\n\n\n\n\nDer er et problem her: En sandsynlighed ligger altid mellem 0 og 1, men regressionslinjen ovenfor skærer \\(x\\)-aksen ved blodtryksværdier omkring 70. Det betyder, at sandsynligheden er negativ for blodtryk under 70. Tilsvarende får vi sandsynligheder, der er større end 1 ved blodtryk over 300. Det giver selvfølgelig ikke mening.\nHvis vi kigger på figur 3 igen, ser sammenhængen da heller ikke lineær ud, men snarere S-formet. I stedet for en ret linje, ville det give mening at lade \\(p\\) være en funktion med en S-formet graf som indtegnet i figur 4.\n\n\n\n\n\n\n\n\nFigur 4: Graf for p(x) tilnærmet med en S-formet kurve."
  },
  {
    "objectID": "log-reg.html#logistisk-regression",
    "href": "log-reg.html#logistisk-regression",
    "title": "Logistisk regression",
    "section": "",
    "text": "I det følgende skal vi se på logistisk regression. Måske har du allerede hørt begrebet logistisk regression ME: Eller du har måske hørt begrebet \"logistisk\"   i gymnasieundervisningen i forbindelse med logistisk vækst. Dette er en anden type af logistisk regression end den, der behandles i denne note. I slutningen af noten vil vi dog se et eksempel, hvor der alligevel er en sammenhæng mellem logistisk regression og logistisk vækst.\nLogistisk regression, i den betydning vi kigger på i denne note, bruges, når man gerne vil modellere, hvordan en sandsynlighed afhænger af en anden variabel. Som et eksempel forestiller vi os, at vi er interesserede i, hvordan sandsynligheden for at lide af hjerte-kar-sygdom afhænger af det systoliske blodtryk.\nVi vil kigge på et datasæt bestående af 2000 mennesker, som har fået målt deres blodtryk. Desuden har de fået undersøgt, om de lider af hjerte-kar-sygdom. Datasættet er fiktivt, men det er lavet til at ligne virkelige data1. Vi kalder blodtrykket for \\(x\\), mens vi lader \\(y\\) være en variabel, der er \\(1\\) hvis personen lider af hjertekarsygdom og \\(0\\) ellers. På figur 1 har vi tegnet samhørende \\(x\\)- og \\(y\\)-værdier ind i et koordinatsystem for de første 200 personer i datasættet.\n1 De fleste mennesker har et systolisk blodtryk mellem 100 og 180 mmHg. I datasættet har vi genereret en masse mennesker med ekstremt højt eller lavt blodtryk for illustrationens skyld, selv om det er urealistisk i praksis.\n\n\n\n\n\n\n\nFigur 1: Her ses et plot af data med blodtryk på \\(x\\)-aksen og sygdomsstatus på \\(y\\)-aksen.\n\n\n\n\n\nDet ses på figur 1, at der er flest personer med \\(y\\)-værdien 0, altså raske personer, blandt folk med lavt blodtryk, mens der er flest med \\(y\\)-værdien 1, svarende til syge, blandt folk med højt blodtryk. Men ved de fleste blodtryksværdier er der både syge og raske, og det er svært at få et præcist overblik ud fra figuren. Så hvordan kan man beskrive sammenhængen mellem \\(x\\) og \\(y\\)? I stedet for at se direkte på sammenhængen mellem \\(x\\) og \\(y\\), vil vi se på hvordan sandsynligheden for hjerte-kar-sygdom (\\(y=1\\)) afhænger af blodtrykkket. Vi vil betragte denne sandsynlighed som en funktion \\(p(x)\\), hvor funktionsværdien afhænger af blodtrykket \\(x\\). Vi ser nu på, hvordan man kan modellere denne funktion.\nFor at få en idé om, hvordan \\(p(x)\\) kunne se ud, kigger vi på datasættet fra før. Vi inddeler nu blodtrykket i intervaller af længde 25 og tæller op, hvor mange syge og raske der er inden for hvert interval. tabel gøres lidt pænere\n\n\n\nTabel 1: Tabel over syge og raske inden for forskellige blodtryksintervaller\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBlodtryk\n]75,100]\n]100,125]\n]125,150]\n]150,175]\n]175,200]\n]200,225]\n]225,250]\n]250,275]\n]275,300]\n\n\n\n\nRask\n173\n194\n145\n156\n98\n57\n47\n25\n19\n\n\nSyg\n24\n42\n62\n100\n132\n135\n178\n203\n210\n\n\nAndel syge\n0.122\n0.178\n0.300\n0.391\n0.574\n0.703\n0.791\n0.890\n0.917\n\n\n\n\n\n\nDesuden har vi beregnet, hvor stor en andel af patienterne inden for hvert interval, der lider af hjerte-kar-sygdom. Dette bruges som et estimat for sandsynligheden for hjerte-kar-sygdom i den gruppe. For eksempel er der 194 raske og 42 syge personer med et blodtryk i intervallet \\(]100,125]\\). Sammenlagt er der \\(194+42=236\\) personer i dette interval. Andelen af syge i denne gruppe er derfor \\[\n\\frac{42}{236} \\approx 0.178.\n\\] På figur 2 har vi tegnet disse andele ind i et koordinatsystem. For hvert blodtryksinterval er midtpunktet for intervallet indtegnet som \\(x\\)-værdien, og andelen af syge er indtegnet som den tilhørende \\(y\\)-værdi.\nME: For meget luft om figur\n\n\n\n\n\n\n\n\nFigur 2: Andel syge inden for hvert blodtryksinterval.\n\n\n\n\n\nUmiddelbart kunne det være fristende at lave lineær regression. Vi forestiller os altså en forskrift \\[\n    p(x) = ax + b.\n\\] På figur 3 har vi indtegnet den bedste rette linje i figur 2.\n\n\n\n\n\n\n\n\nFigur 3: Grafen for p(x) tilnærmet med en ret linje.\n\n\n\n\n\nDer er et problem her: En sandsynlighed ligger altid mellem 0 og 1, men regressionslinjen ovenfor skærer \\(x\\)-aksen ved blodtryksværdier omkring 70. Det betyder, at sandsynligheden er negativ for blodtryk under 70. Tilsvarende får vi sandsynligheder, der er større end 1 ved blodtryk over 300. Det giver selvfølgelig ikke mening.\nHvis vi kigger på figur 3 igen, ser sammenhængen da heller ikke lineær ud, men snarere S-formet. I stedet for en ret linje, ville det give mening at lade \\(p\\) være en funktion med en S-formet graf som indtegnet i figur 4.\n\n\n\n\n\n\n\n\nFigur 4: Graf for p(x) tilnærmet med en S-formet kurve."
  },
  {
    "objectID": "log-reg.html#odds",
    "href": "log-reg.html#odds",
    "title": "Logistisk regression",
    "section": "Odds",
    "text": "Odds\nFor at komme nærmere hvordan funktionsforskriften for \\(p\\) skal se ud, kigger vi på oddsene for sygdom i stedet for sandsynligheden2. Oddsene \\(O\\) for en hændelse er defineret som sandsynligheden \\(p\\) for hændelsen divideret med sandsynligheden for, at hændelsen ikke indtræffer (det kaldes også for komplementærhændelsen), som er \\(1-p\\). Altså er \\[\n    O=\\frac{p}{1-p}.\n\\] Odds måler således, hvor mange gange mere sandsynlig en hændelsen er i forhold til komplementærhændelsen. Hvis for eksempel sandsynligheden for hjerte-kar-sygdom er \\(p=\\frac{4}{5}\\), så er odds for sygdom \\[\n    O=\\frac{\\frac{4}{5}}{\\frac{1}{5}} = 4.\n\\] Det er altså fire gange så sandsynligt at være syg som at være rask.\n2 Du kender måske begrebet odds fra sportsgambling. Det er dog en anden betydning af ordet, end det vi bruger her. Inden for gambling angiver odds, hvor mange gange man får pengene igen, hvis en bestemt hændelse indtræffer(for eksempel at et bestemt hold vinder). Gambling odds er naturligvis også udregnet ud fra sandsynligheden for hændelsen, men de er altid justeret for at sikre, at bookmakeren vinder i det lange løb.For at få en lidt bedre fornemmelse for, hvordan odds fungerer, kan vi lave en tabel, der viser odds svarende til forskellige værdier af \\(p\\):\n\n\n\n\n\n\n\n\n\n\n\n\n\n\\(p\\)\n\\(\\frac{1}{5}\\)\n\\(\\frac{1}{4}\\)\n\\(\\frac{1}{3}\\)\n\\(\\frac{1}{2}\\)\n\\(\\frac{2}{3}\\)\n\\(\\frac{3}{4}\\)\n\\(\\frac{4}{5}\\)\n\n\n\n\n\\(O\\)\n\\(\\frac{1}{4}\\)\n\\(\\frac{1}{3}\\)\n\\(\\frac{1}{2}\\)\n1\n2\n3\n4\n\n\n\nME: Læg mærke til at jo større \\(p\\) bliver desto større bliver odds \\(O\\) også.\nFunktionen, der omdanner sandsynligheder til odds, har forskriften \\[\nO(p) = \\frac{p}{1-p}.\n\\] Definitionsmængden for \\(f\\) er \\(]0,1[\\). Grafen for \\(f\\) er vist på figur 5. ME: Funktionen hedder vel \\(O\\) og ikke \\(f\\)?\n\n\n\n\n\n\n\n\nFigur 5: Grafen for odds-funktionen.\n\n\n\n\n\nME: Kommentar om at \\(O\\) er voksende? Måske opgave hvor man kan vise at \\(O'&gt;0\\)?  Vi ser, at \\(O(p)\\) altid er positiv, da både tæller og nævner er positive. Når \\(p\\) nærmer sig \\(0\\), nærmer tælleren sig \\(0\\), mens nævneren nærmer sig \\(1\\), så \\(O(p)\\) går mod \\(0\\). Når \\(p\\) nærmer sig \\(1\\), nærmer tælleren sig \\(1\\), og nævneren nærmer sig \\(0\\), så hele brøken \\(O(p)\\) går mod uendelig. Værdimængden for \\(O\\) består derfor af alle de positive reelle tal.\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\nME: Skal vi nummerere opgaverne?\n\nLad \\(p=4/7\\). Hvad er de tilhørende odds?\nAntag at oddsene er \\(O=3/2\\). Hvad er den tilsvarende sandsynlighed?\nFodboldholdene AFC og BFC spiller mod hinanden. Der spilles med forlænget spilletid og straffesparkskonkurrence indtil, der er fundet en vinder. Det er dobbelt så sandsynligt, at AFC vinder som, at BFC vinder. Hvad er (de matematiske) odds for at AFC vinder? Hvad er sandsynligheden for at AFC vinder?"
  },
  {
    "objectID": "log-reg.html#den-logistiske-regressionsmodel",
    "href": "log-reg.html#den-logistiske-regressionsmodel",
    "title": "Logistisk regression",
    "section": "Den logistiske regressionsmodel",
    "text": "Den logistiske regressionsmodel\nI vores dataeksempel, hvor sandsynligheden for hjerte-kar-sygdom er en funktion \\(p(x)\\), bliver oddsene for hjerte-kar-sygdom også en funktion af \\(x\\) \\[\nO(p(x)) = \\frac{p(x)}{1-p(x)}.\n\\] På figur 6 vises dataeksemplet fra før, men nu har vi oddsene \\(O(p(x))\\) på \\(y\\)-aksen.\n\n\n\n\n\n\n\n\nFigur 6: Odds for hjerte-kar-sygdom inden for de forskellige blodtryksintervaller.\n\n\n\n\n\nVi ser, at oddsene for sygdom stiger med blodtrykket. ME: Det betyder derfor også at sandsynligheden for sygdom stgier med blodtrykket  Kigger vi på grafen, ser tendensen ikke lineær ud. Det kunne derimod ligne en eksponentiel vækst. For at bekræfte dette, laver vi samme plot på figur 7, men nu med den naturlige logaritme til oddsene \\(\\ln (O(p(x)))\\) på \\(y\\)-aksen. ME: Fodnote om at hvis \\(y\\) afhænger eksponentielt af \\(x\\), så vil \\(\\ln(y)\\) afhænge lineært af \\(x\\). \n\n\n\n\n\n\n\n\nFigur 7: Den naturlige logaritme til odds for hjerte-kar-sygdom inden for de forskellige blodtryksintervaller.\n\n\n\n\n\nDer ser nu ud til at være en lineær sammenhæng! Det kunne altså tyde på, at ln-oddsene afhænger lineært af \\(x\\). Det leder os frem til følgende model for ln-oddsene: \\[\n\\ln (O(p(x))) = ax  + b.\n\\tag{1}\\] Denne model kaldes den logistiske regressionsmodel. Virkelige data følger ofte en logistisk regressionsmodel.\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\nME: Ændret i opstilling :)  I denne opgave ser vi på sandsynligheden \\(p(x)\\) for at lide af forhøjet blodtryk3 som funktion af kolestreroltallet \\(x\\).Opgaverne kan ikke foldes ind pga. fodnoten… Vi kigger derfor på datasættet i tabel 2, som er en udvalgt del af et virkeligt datasæt.Kan man lave litteraturhenvisninger? I tabellen angiver \\(y=1\\) forhøjet blodtryk, mens \\(y=0\\) angiver normalt blodtryk.\n\nLav en tabel, hvor du beregner sandsynligheden for forhøjet blodtryk, odds og ln(odds) inden for hvert interval.\nIndtegn punkter i et koordinatsystem, hvor \\(x\\)-værdien er midtpunkterne for intervallerne, og \\(y\\)-værdien er de tilhørende odds. ME: Er det ikke det samme -&gt;  Tegn samhørende værdier af \\(x\\) og ln(odds) ind i et koordinatsystem.\nSer sammenhængen lineær ud?\nVil det give mening at bruge en logistisk regression?\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx\n]100,150]\n]150,200]\n]200,250]\n]250,300]\n]300,350]\n]350,400]\n]400,450]\n\n\n\n\ny=0\n27\n693\n1354\n716\n156\n20\n2\n\n\ny=1\n6\n202\n571\n471\n132\n23\n5\n\n\n\n\n\n\n** ME: Måske vi skal droppe tabelteksten? **\n\n\n\n3 Forhøjet blodtryk er defineret som systolisk blodtryk højere end 140mmHg eller diastolisk blodtryk højere end 90mmHg.\nTabel 2: Tabel over syge og raske inden for forskellige intervaller af kolesteroltal."
  },
  {
    "objectID": "log-reg.html#logit-funktionen-og-den-logistiske-funktion",
    "href": "log-reg.html#logit-funktionen-og-den-logistiske-funktion",
    "title": "Logistisk regression",
    "section": "Logit-funktionen og den logistiske funktion",
    "text": "Logit-funktionen og den logistiske funktion\nNår vi tager den naturlige logaritme til oddsene, får vi \\[\n\\ln (O(p)) = \\ln\\left(\\frac{p}{1-p}\\right).\n\\] Funktionen på højresiden kaldes \\(\\text{logit}\\) og er altså givet ved \\[\n\\text{logit}(p) = \\ln\\left(\\frac{p}{1-p}\\right).\n\\] Definitionsmængden for \\(\\text{logit}\\)-funktionen er ligesom for oddsene \\(]0,1[\\). Vi fandt tidligere, at værdimængden for oddsene består af alle de positive reelle tal. Dette er netop definitionsmængden for \\(\\ln\\). Værdimængden for \\(\\text{logit}\\) bliver derfor den samme som for \\(\\ln\\), nemlig alle de reelle tal. Grafen for \\(\\text{logit}\\) er vist på figur 8.\n\n\n\n\n\n\n\n\nFigur 8: Grafen for logit-funktionen.\n\n\n\n\n\nDen logistiske regressionsmodel i (1) kan skrives ved hjælp at \\(\\text{logit}\\)-funtionen som \\[\n\\text{logit}(p(x)) = \\ln (O(p(x))) = ax  + b.\n\\tag{2}\\] Egentlig var vi jo ude på at finde et udtryk for sandsynligheden \\(p(x)\\) som funktion af \\(x\\). Vi prøver derfor at isolere \\(p(x)\\) i (2). eller kalder de det omvendt funktion? For at gøre det, finder vi først den inverse funktion til \\(\\text{logit}\\). Vi antager derfor, at \\[\ny = \\text{logit(p)} = \\ln\\left( \\frac{p}{1-p} \\right).\n\\] Vi skal så isolere \\(p\\) for at udtrykke \\(p\\) som funktion af \\(y\\). Vi tager først eksponentialfunktionen på begge sider af udtrykket og får \\[\ne^y =  \\frac{p}{1-p}.\n\\] ME: Punktum efter udtryk (ved godt at det er korrekt)  Så ganger vi med \\((1-p)\\) på begge sider. Det giver \\[\ne^y(1-p) =p.\n\\] Hvis parentesen ophæves, får vi \\[e^y - p\\cdot e^y =p.\\]\nVi kan så lægge \\(p\\cdot e^y\\) til på begge sider og sætte \\(p\\) uden for parantes. Det giver \\[\\begin{align*}\ne^y &= p \\cdot e^y+p  \\\\\ne^y &= p\\cdot (e^y+1).\n\\end{align*}\\] Endelig kan vi isolere \\(p\\) og få \\[\n\\frac{e^y}{e^y+1} =p.\n\\] Her er \\(p\\) egentlig isoleret, men vi kan vælge at forkorte brøken med \\(e^y\\) for at få et andet udtryk for \\(p\\) \\[\np=\\frac{\\frac{e^y}{e^y}}{\\frac{e^y+1}{e^y}}=\\frac{\\frac{e^y}{e^y}}{\\frac{e^y}{e^y}+\\frac{1}{e^y}}    =\\frac{1}{1+e^{-y}} .\n\\]\nSammenlagt har vi vist, at den inverse funktion til logit er den standard logistiske funktion lyder lidt dumt på dansk (også nogle gange kaldet sigmoid-funktionen) \\[\nf(y) = \\frac{1}{1+e^{-y}}.\n\\] Grafen for den standard logistiske funktion er indtegnet i figur 9. Vi ser, at grafen har en karakteristisk S-form, som vokser fra \\(0\\) mod \\(1\\).\n\n\n\n\n\n\n\n\nFigur 9: Grafen for den standard logistiske funktion\n\n\n\n\n\nBruger vi den inverse til \\(\\text{logit}\\) på begge sider af lighedstegnet i den logistiske regressionsmodel i (2), får vi isoleret \\(p(x)\\) \\[\np(x) = \\frac{1}{1+e^{-(ax+b)}}.\n\\tag{3}\\] Det ligner altså den standard logistiske funktion, men med \\((ax+b)\\) indsat på \\(y\\)’s plads. Denne funktion kaldes den generelle logistiske funktion."
  },
  {
    "objectID": "log-reg.html#fortolkning-af-parametrene-i-den-logistiske-regressionsmodel",
    "href": "log-reg.html#fortolkning-af-parametrene-i-den-logistiske-regressionsmodel",
    "title": "Logistisk regression",
    "section": "Fortolkning af parametrene i den logistiske regressionsmodel",
    "text": "Fortolkning af parametrene i den logistiske regressionsmodel\nHvordan skal vi forstå betydningen af konstanterne \\(a\\) og \\(b\\) i den logistiske regressionsmodel? Hvis man har en funktion \\(f\\), så svarer funktionen \\(f(ax)\\) til, at væksthastigheden er blevet sat op med en faktor \\(a\\). Alternativt kan man forestille sig, at \\(x\\)-aksen er blevet skaleret med en faktor \\(1/a\\). Grafen for \\(f(x-k)\\) svarer til, at man har forskudt grafen med \\(k\\) enheder i \\(x\\)-aksens retning. Hvis man kombinerer disse, kan man indse, at \\(f(ax+b)\\) svarer til først at øge væksthastigheden med en faktor \\(a\\) og derefter forskyde grafen med \\(k=\\frac{-b}{a}\\) i \\(x\\)-aksens retning, idet \\[f(ax+b)=f\\Big(a\\cdot \\Big(x-\\Big(\\frac{-b}{a}\\Big)\\Big)\\Big).\\]\nHvis man gør dette for den standard logistiske funktion, får man netop den generelle logistiske funktion \\[\nf(ax+b)= \\frac{1}{1+e^{-(ax+b)}}.\n\\] Sammenlignet med den standard logistiske funktion får man altså en \\(S\\)-formet kurve, der vokser \\(a\\) gange så hurtigt og er forskudt med \\(\\frac{-b}{a}\\). Fx får man for \\(a=2\\) og \\(b=-5\\): ** ME: \\(b\\) er sat til \\(-0.5\\) i stedet for \\(-5\\) nedenfor. **\n\n\n\n\n\n\n\n\n\nHer kunne det være godt i stedet med et interaktivt plot, hvor de selv kan skrue på a og b I app’en herunder ser du grafen for \\(f(x)=...\\)\n\n\n\n\n\n\n\n\n\n\n\n\n\nI den logistiske regressionsmodel (3) er \\(p(x)\\) givet ved en generel logistisk funktion. Det var netop sådan en generel logistisk funktion, der blev brugt til at lave den S-formede kurve på figur 4.\nEn anden måde at fortolke konstanterne \\(a\\) og \\(b\\) på er ved at gå tilbage til at se på oddsene. For at få et udtryk for oddsene i den logistiske regressionsmodel, kan vi anvende eksponentialfunktionen på begge sider i (1) og få \\[\nO(x) = e^{ax + b} = e^b \\cdot e^{ax}=e^b \\cdot (e^{a})^x.\n\\] Hvis \\(e^b\\) kaldes \\(b_{ny}\\), og \\(e^{a}\\) kaldes \\(a_{ny}\\), ses at \\[O(x)=b_{ny}\\cdot a_{ny}^x\\] er en eksponentiel udvikling med fremskrivningsfaktor \\(a_{ny}=e^a\\). Derved vil odds for sygdom stige med \\(r=e^a-1\\) procent, hver gang blodtrykket stiger med \\(1\\)mmHg. Hvis \\(a\\) er positiv, er \\(e^a&gt;1\\), og oddsene vokser altså eksponentielt. Hvis derimod \\(a\\) er negativ, er \\(e^a&lt;1\\), og dermed aftager oddsene eksponentielt.\nI forbindelse med logistisk regression kaldes \\(e^a\\) også for odds-ratioen. For at forstå hvorfor, kan vi forestille os to patienter, en med blodtryk \\(x_1\\) og en med blodtryk \\(x_2\\). De har dermed oddsene \\[\\begin{align*}\nO(x_1) &= e^b \\cdot e^{ax_1}\\\\\nO(x_2) &= e^b \\cdot e^{ax_2}.\n\\end{align*}\\] Lad os se på forholdet (ratioen) mellem de to personers odds: \\[\n\\frac{O(x_1)}{O(x_2)} = \\frac{e^b \\cdot e^{ax_1}}{ e^b \\cdot e^{ax_2}} = \\frac{e^{ax_1}}{e^{ax_2}} = e^{ax_1 - ax_2} = e^{a(x_1 - x_2)} = (e^{a} )^{x_1-x_2}.\n\\] Forholdet mellem oddsene afhænger altså kun af forskellen \\(x_1 - x_2\\) mellem de to personers blodtryk. Hvis person 1 er har et blodtryk, der er 1mmHg højere end person 2, bliver forholdet (ratioen) mellem oddsene lige præcis \\(e^a\\).\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\n\nGrafen for den generelle logitiske funktion er stejlest ME: Indsætte funktionsforskrift for \\(f\\) her? , når funktionsværdien er \\(f(x)=1/2\\). Hvilken værdi af \\(x\\) svarer til en funktionsværdi på \\(1/2\\) (\\(x\\) kan udtrykkes ved hjælp af \\(a\\) og \\(b\\)).\nI et (fiktivt) dataeksempel ser vi på sandsynligheden \\(p(x)\\) for, at en kunde i et supermarked vælger at købe den økologiske mælk frem for den konventionelle som funktion af kundens årlige indtægt \\(x\\) (i 100.000 kr). Vi kommer frem til følgende logistiske regressionsmodel \\[\\text{logit}(p(x))= -1.3+0.5x. \\] Tegn grafen for \\(p(x)\\). Hvor mange procent stiger odds for at vælge økologisk, når årsindtægten stiger med 100.000kr?"
  },
  {
    "objectID": "log-reg.html#maksimum-likelihood-estimation",
    "href": "log-reg.html#maksimum-likelihood-estimation",
    "title": "Logistisk regression",
    "section": "Maksimum likelihood estimation",
    "text": "Maksimum likelihood estimation\nI den logistiske regressionsmodel \\[\n\\ln (O(x)) = \\text{logit}(p(x)) = ax  + b.\n\\] indgår to ukendte konstanter \\(a\\) og \\(b\\). Hvis vi har et datasæt, hvordan finder vi så de værdier af \\(a\\) og \\(b\\), der passer bedst til vores data?\nVed at se på figur 7 kunne man fristes til at benytte lineær regression til at finde \\(a\\) og \\(b\\). Bemærk dog, at hvert punkt egentlig er beregnet ud fra fra flere observationer, som ikke har samme \\(x\\)-værdi. Med et lille datasæt ville det slet ikke være muligt at lave en intervalinddeling som i tabel 1, uden at der kommer meget få personer i nogle grupper. Begge dele gør, at de beregnede værdier af \\(\\ln(O(x))\\) bliver meget upræcise, og det samme gør estimaterne for \\(a\\) og \\(b\\) derfor.\nI stedet benytter man som regel maksimum likelihood metoden, som er en teknik, der stammer fra statistikken. Kort fortalt er idéen at vælge de værdier af \\(a\\) og \\(b\\), der gør vores data så sandsynligt som muligt.\nLad os kalde punkterne i vores datasæt \\((x_i,y_i)\\), hvor \\(i=1,\\ldots,n\\) er en nummerering af datapunkterne. Her angiver \\(x_i\\) altså blodtrykket hos den \\(i\\)’te person, og \\(y_i\\) er en variabel, der antager værdien \\(1\\) hvis \\(i\\)’te person har hjerte-kar-sygdom og er \\(0\\) ellers. For hvert par \\((x_i,y_i)\\) kan vi nu forsøge at beregne sandsynligheden \\(p_i\\) for at \\(i\\)’te person faktisk har den sygsomsstatus \\(y_i\\), som vi observerer. Hvis den \\(i\\)’te person er syg, dvs. \\(y_i=1\\), er \\(p_i\\) altså sandsynligheden for at være syg, når blodtrykket er \\(x_i\\), så \\[\np_i= p(x_i)  = \\frac{ 1}{1 + e^{-(ax_i  + b)}}.\n\\tag{4}\\] Hvis patienten er rask, altså \\(y_i=0\\), er \\(p_i\\) sandsynligheden for at være rask, når blodtrykket er \\(x_i\\), det vil sige \\[\np_i=1-  p(x_i)  = 1- \\frac{ 1}{1 + e^{-(ax_i  + b)}}.\n\\tag{5}\\] Vi kan opskrive et samlet udtryk for \\(p_i\\) uden at opdele efter værdien af \\(y_i\\), nemlig \\[ p_i= p_i(x_i)^{y_i}(1-p(x_i))^{1-y_i}. \\tag{6}\\] For at indse dette, ser vi først på tilfældet \\(y_i=1\\), hvor (6) giver \\[p_i = p(x_i)^{1} (1-p(x_i))^{0} = p(x_i).\\] For \\(y_i=0\\) giver (6)\n\\[p_i = p(x_i)^{0} (1-p(x_i))^{1} = 1-p(x_i).\\] Det passer altså med formlerne i henholdsvis (4) og (5). Bemærk at \\(p_i\\) afhænger af de ukendte værdier \\(a\\) og \\(b\\). Vi kan altså opfatte \\(p_i\\) som en funktion af to variable \\(p_i(a,b)\\).\nNu kigger vi på den samlede sandsynlighed for at observere netop de værdier \\(y_1,\\ldots,y_n\\), som vi faktisk har observeret, når vi ved at patienternes blodtryk er givet ved \\(x_1,\\ldots,x_n\\). Til det formål antager vi, at personerne i datasættet er uafhængige af hinanden4.\n4 Afhængigheder kan for eksempel opstå, hvis mange af personerne er i familie med hinanden, går i klasse sammen eller bor i samme by. I så fald kan de have noget til fælles, der gør at deres \\(y\\)-værdier er mere ens end ellers. Familiemedlemmer kan fx have samme arvelige tendens til hjerte-kar-sygdom. Som regel forsøger man at undgå sådanne afhængigheder, når man indsamler data.For at komme videre, er vi nødt til at vide lidt om uafhængighed af hændelser: Husk på at to hændelser \\(A\\) og \\(B\\) er uafhængige, hvis man kan finde sandsynligheden for fælleshændelsen \\(A\\cap B\\) (at \\(A\\) og \\(B\\) indtræffer på en gang) ved at gange de enkelte sandsynligheder sammen: \\[\n    P(A\\cap B) = P(A)\\cdot P(B).\n\\]\nUafhængighed af \\(n\\) hændelser \\(A_1,\\ldots,A_n\\) betyder tilsvarende, at sandsynligheden for, at alle \\(n\\) hændelser indtræffer på samme tid \\(A_1 \\cap A_2 \\cap \\dotsm \\cap A_n\\), kan findes som et produkt af sandsynlighederne for de enkelte hændelser5 \\[\n    P(A_1 \\cap A_2 \\cap \\dotsm \\cap A_n) = P(A_1)\\cdot P(A_2) \\cdot \\dotsm \\cdot P(A_n).\n\\]\n5 Desuden skal der gælde, at hver gang vi udtager \\(m\\) ud af de \\(n\\) hændelser, skal sandsynligheden for, at de \\(m\\) hændelser indtræffer samtidig, kunne findes ved en tilsvarende produktformel, men dette skal vi ikke bruge i det følgende.Vi vender nu tilbage til vores data og lader \\(A_1\\) være hændelsen at første patient har sygdomsstatus \\(y_1\\), \\(A_2\\) være hændelsen at anden patient har sygdomsstatus \\(y_2\\) og så videre. Bemærk, at \\(P(A_i)\\) er det samme, som det vi tidligere kaldte \\(p_i(a,b)\\). Hændelsen at vi observerer \\(y_1,\\ldots,y_n\\) på samme tid, er fælleshændelsen \\(A_1 \\cap A_2 \\cap \\dotsm \\cap A_n\\). Da vi antog, at de \\(n\\) personer er udvalgt uafhængigt af hinanden, kan vi bruge produktformlen: \\[\nP(A_1 \\cap A_2 \\cap \\dotsm \\cap A_n) = P(A_1) \\cdot \\dotsm \\cdot P(A_n) = p_1(a,b) \\cdot p_2(a,b)\\cdot \\dotsm \\cdot p_n(a,b).\n\\] Bemærk, at sandsynligheden for vores udfald \\(y_1,\\ldots,y_n\\) afhænger af \\(a\\) og \\(b\\). Den kan derfor betragtes som en funktion af to variable \\[\nL(a,b) = p_1(a,b) \\cdot p_2(a,b)\\cdot \\dotsm \\cdot p_n(a,b).\n\\] Denne funktion kaldes likelihoodfunktionen. Idéen med maksimum likelihood metoden er at vælge de værdier af \\(a\\) og \\(b\\), der gør sandsynligheden \\(L(a,b)\\) for det, vi har observeret så stor som mulig. Vi søger altså de \\(a\\) og \\(b\\), der maksimerer funktionen \\(L(a,b)\\). Dette maksimum kan ikke udregnes eksakt. I stedet kan man bruge numeriske metoder, for eksempel gradient nedstigning, som I kan læse mere om her ME: Link virker først når siden er flyttet over på hjemmesiden. Man kan også forsøge at finde kritiske punkter, altså punkter, hvor de partielt afledte er nul, ved hjælp af numeriske metoder. Overvej hvad vi vil gøre her. Vi kan også droppe det og bare bruge Excel?\nFinder man \\(a\\) og \\(b\\) ved hjælp af maksimum likelihood metoden i vores dataeksempel, fås følgende funktionsudtryk for sandsynlighederne og oddsene \\[\n    p(x) = \\frac{1}{1+e^{-0.0230 x +4.07}}, \\qquad O(x)=e^{0.0230 x -4.07}.\n\\]\nGrafen for \\(p\\) er vist på figur 4. Vi har en odds-ratio på \\(e^{0.023} \\approx 1.0233\\). Odds for hjerte-kar-sygdom stiger derfor med en faktor 1.0233 (altså 2,33%), for hver gang blodtrykket stiger med \\(1\\) mmHg.\n\nYderligere omskrivning af likelihoodfunktionen\nVi ser nu lidt nærmere på, hvordan man selv kan finde \\(a\\) og \\(b\\), der maksimerer værdien af likelihoodfunktionen \\(L(a,b)\\). Til det formål omskriver vi først likelihoodfunktionen til noget, der er lidt nemmere at regne på. Vi havde \\[\nL(a,b) = p_1(a,b) \\cdot p_2(a,b)\\cdot \\dotsm \\cdot p_n(a,b).\n\\tag{7}\\] Da \\(\\ln(x)\\) er en voksende funktion, vil \\(L(a,b)\\) have maksimum for de samme værdier af \\(a\\) og \\(b\\) som den sammensatte funktion \\(l(a,b)=\\ln(L(a,b))\\). Det er altså nok at finde de værdier af \\(a\\) og \\(b\\), der maksimerer \\(l(a,b)\\).\nTager vi logaritmen i (7) og bruger logaritmeregnereglen \\(\\ln(a\\cdot b) = \\ln(a) + \\ln(b)\\), får vi \\[l(a,b)=\\sum_{i=1}^n \\ln(p_i(a,b)). \\tag{8}\\] Vi fandt i (6), at \\[p_i(a,b)=p(x_i)^{y_i}\\cdot (1-p(x_i))^{1-y_i}.\\] Vi kan nu finde \\(\\ln(p_i(a,b))\\) ved først at benytte regnereglen \\(\\ln(a\\cdot b) = \\ln(a) + \\ln(b)\\) og dernæst regnereglen \\(\\ln(a^k)=k\\cdot \\ln(a)\\). Det giver \\[\\begin{align*}\n\\ln(p_i(a,b)) &=  \\ln\\big(p(x_i)^{y_i}\\big) + \\ln\\big((1-p(x_i))^{1-y_i}\\big) \\\\\n&= {y_i}\\cdot \\ln(p(x_i))+(1-y_i)\\cdot \\ln(1-p(x_i))\n\\end{align*}\\] Samlet set får vi \\[l(a,b)=\\sum_{i=1}^n \\ln(p_i(a,b))  = \\sum_{i=1}^n\\big( {y_i}\\cdot \\ln(p(x_i))+(1-y_i)\\cdot \\ln(1-p(x_i)) \\big). \\tag{9}\\] Dette udtryk kan man nemt selv udregne og maksimere ved hjælp af Excel.\n\n\nBestemmelse af \\(a\\) og \\(b\\) med Excels problemløser-værktøj\nFor at finde estimater for \\(a\\) og \\(b\\) ved hjælp af Excel, skal man først og fremmest sørge for, at man har aktiveret problemløser-værktøjet. Det gøres på følgende måde: Gå op under filer og vælg indstillinger. Derefter vælges tilføjelsesprogrammer. Nederst kan man vælge Excel-tilføjelsesprogrammer og trykke udfør. Til sidst kan man vælge tilføjelsesprogrammet problemløser fra en liste.\nME: Lidt utydeligt billede. \n\n\n\nIllustration af Excel ark til bestemmelse af a og b samt brug af problemløser.\n\n\nPå billedet ses, hvordan man kan lave et lille regneark til at beregne de relevante størrelser. Der er lavet et par celler til de ukendte parametre \\(a\\) og \\(b\\), som bare kan sættes til 0 fra starten. Det oprindelige datasæt indsættes i søjlerne \\(x_i\\) og \\(y_i\\). I de næste søjler beregnes odds, \\(p(x_i)\\) og \\(\\ln(p_i)\\) med formlerne \\[\\begin{align*}\nodds &= e^{ax_i + b}\\\\\np(x_i) &= \\frac{e^{ax_i + b}}{1+e^{ax_i +b}} = \\frac{odds}{1+odds}\\\\\n\\ln(p_i)&= {y_i}\\cdot \\ln(p(x_i))+(1-y_i)\\cdot \\ln(1-p(x_i)).\n\\end{align*}\\] Her er det vigtigt, at cellerne, der indeholder værdien af \\(a\\) og \\(b\\), benyttes når oddsene beregnes (det vil være smart med fastlåsning af referencerne, hvor man har $ foran både tal og bogstav ved reference). Til sidst finder man \\(l(a,b)\\) i det blå felt ved at beregne summen af alle \\(\\ln(p_i)\\), som i formlen (9).\nNu mangler man bare at benytte problemløseren til at finde de værdier af \\(a\\) og \\(b\\), der gør værdien i det blå felt maksimal. På billedet er der vist med rød, hvor man finder problemløseren, og hvad der skal justeres. Målsætningen er den blå celle, der indeholder summen. Variabelcellerne er de to, der indeholder \\(a\\) og \\(b\\). Sørg for ikke at sætte flueben i boksen “Gør variabler uden begrænsninger ikke-negative”. Tryk på løs.\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\n\nAntag, at vi har tre observationer nedenfor. Opskriv et udtryk for likelihoodfunktionen \\(L(a,b)\\).\n\n\n\n\nx\n1\n2\n3\n\n\n\n\ny\n1\n1\n0\n\n\n\n\nEn nyhedshjemmeside ønsker at målrette en biografreklame til brugerne. De har derfor registreret om 10 af hjemmesidens brugere har klikket på reklamen (\\(y=1\\) hvis de har klikket, \\(y=0\\) ellers) og hvor mange gange \\(x\\), de har læst kulturnyheder den sidste måned. Datasættet er givet i nedenstående tabel. Firmaet bag hjemmesiden ønsker at modellere sandsynligheden \\(p(x)\\) for at klikke på reklamen som funktion af \\(x\\), så de kan målrette reklamen mod de brugere, der har størst sandsynlighed for at klikke på den. Brug Excel til at finde \\(a\\) og \\(b\\). Tegn grafen for \\(p(x)\\). Skal firmaet vælge at vise reklamen til brugere, der ofte eller sjældent læser kulturnyheder?\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nx\n0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n\n\n\n\ny\n0\n0\n1\n0\n0\n1\n1\n1\n1\n1\n\n\n\n\n\n\nJeg foreslår at lægge nedenstående i et separat link\n\n\n\n\n\n\nMaksimering af \\(l(a,b)\\) ved brug af partielt afledte\n\n\n\n\n\nNår \\(l(a,b)\\) skal maksimeres, kan det gøres ved hjælp af partielt afledede. Husk på, at i et maksimumspunkt, vil begge de partielt afledte være lig 0, dvs. \\[\\begin{align*}\n\\frac{\\partial l(a,b)}{\\partial a} &=0 \\\\\n\\frac{\\partial l(a,b)}{\\partial b} &=0.\n\\end{align*}\\] Vi finder derfor først et mere eksplicit udtryk for \\(l(a,b)\\) som funktion af \\(a\\) og \\(b\\).\n\nEksplicit udtryk for l(a,b)\nVed at ophæve parentesen \\((1-y_i)\\) i (9) fås \\[ l(a,b)=\\sum_{i=1}^n \\big({y_i}\\cdot \\ln(p(x_i))+\\ln(1-p(x_i))- y_i\\cdot \\ln(1-p(x_i))\\big).\\] I to af leddene inden for sumtegnet har vi \\(y_i\\) som en faktor. Vi kan derfor sætte \\(y_i\\) uden for parentes \\[ l(a,b)=\\sum_{i=1}^n \\big(\\ln(1-p(x_i))+{y_i}\\cdot (\\ln(p(x_i))-\\ln(1-p(x_i)))\\big).\\] Ved hjælp af logaritmeregnereglen \\(ln(a/b)=ln(a)-ln(b)\\) får vi \\[ l(a,b)=\\sum_{i=1}^n \\left(\\ln(1-p(x_i))+y_i\\cdot \\ln\\left(\\frac{p(x_i)}{1-p(x_i)}\\right)\\right).\\] Her opsplitter vi til to summer, hvor den ene ikke afhænger af \\(y_i\\). \\[ l(a,b)=\\sum_{i=1}^n \\ln(1-p(x_i))+\\sum_{i=1}^n y_i\\cdot \\ln\\left(\\frac{p(x_i)}{1-p(x_i)}\\right). \\tag{10}\\] Nu har vi fået styr på udtrykket for \\(l(a,b)\\), som dog afhænger af \\(p(x_i)\\). Vi udnytter nu, at vi havde udtrykket \\[p(x_i) = \\frac{1}{1+e^{-(a\\cdot x_i+b)}}\\] og \\[\\ln\\left(\\frac{p(x_i)}{1-p(x_i)}\\right)=ax_i + b.\\] Indsættes dette i (10), får vi \\[l(a,b)=\\sum_{i=1}^n \\ln\\left(1-\\frac{1}{1+e^{-(a\\cdot x_i+b)}}\\right)+\\sum_{i=1}^n y_i\\cdot (ax_i+b).\\] Udtrykket i logaritmen sættes på fælles brøkstreg, og brøken forlænges med \\(e^{a\\cdot x_i+b}\\) \\[ l(a,b)=\\sum_{i=1}^n \\ln\\left(\\frac{e^{-(a\\cdot x_i+b)}}{1+e^{-(a\\cdot x_i+b)}}\\right)+\\sum_{i=1}^n y_i\\cdot (ax_i+b)=\\sum_{i=1}^n \\ln\\left(\\frac{1}{1+e^{a\\cdot x_i+b}}\\right)+\\sum_{i=1}^n y_i\\cdot (ax_i+b).\\] Her benytter vi igen regnereglen \\(\\ln(a/b)=\\ln(a)-\\ln(b)\\). \\[ l(a,b)=\\sum_{i=1}^n\\big(\\ln(1)-\\ln(1+e^{a\\cdot x_i+b})\\big)+\\sum_{i=1}^n y_i\\cdot (ax_i+b).\\] Da \\(\\ln(1)=0\\), har vi endelig \\[\nl(a,b)=\\sum_{i=1}^n \\big(-\\ln(1+e^{a\\cdot x_i+b})\\big)+\\sum_{i=1}^n y_i\\cdot (ax_i+b).\n\\tag{11}\\]\n\n\nPartielt afledede\nVi finder nu de partielt afledte af \\(l(a,b)\\) ved at differentiere (11). Lad os først se på \\(\\frac{\\partial l(a,b)}{\\partial b}\\). Vi husker på, at \\(l(a,b)\\) var givet ved \\[\nl(a,b)=\\sum_{i=1}^n \\big(-\\ln(1+e^{a\\cdot x_i+b})\\big)+\\sum_{i=1}^n y_i\\cdot (ax_i+b).\n\\] I den første sum skal vi se hvert led som en sammensat funktion, hvor den indre funktion har et led, som også er en sammensat funktion. \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{1}{1+e^{a\\cdot x_i+b}}\\cdot (0+e^{a\\cdot x_i+b})\\cdot(0+1) +\\sum_{i=1}^n y_i\\cdot (0+1).\\] Ved at reducere fås \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{e^{a\\cdot x_i+b}}{1+e^{a\\cdot x_i+b}} +\\sum_{i=1}^n y_i\\] Ved at bruge (3) i forbindelse med den første sum og efterfølgende samle leddene i en sum, fås \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -p(x_i) +\\sum_{i=1}^n y_i=\\sum_{i=1}^n (y_i-p(x_i)).\\]\nNu ser vi på \\(\\frac{\\partial l(a,b)}{\\partial a}\\) på tilsvarende måde. \\[\\frac{\\partial l(a,b)}{\\partial a}= \\sum_{i=1}^n -\\frac{1}{1+e^{a\\cdot x_i+b}}\\cdot (0+e^{a\\cdot x_i+b})\\cdot(1\\cdot x_i+0) +\\sum_{i=1}^n y_i\\cdot (1\\cdot x_i+0)\\] Der reduceres \\[\\frac{\\partial l(a,b)}{\\partial a}= \\sum_{i=1}^n -\\frac{e^{a\\cdot x_i+b}}{1+e^{a\\cdot x_i+b}}\\cdot x_i +\\sum_{i=1}^n y_i\\cdot x_i.\\] Igen bruges (3) til at få \\[\\frac{\\partial l(a,b)}{\\partial a}= \\sum_{i=1}^n -p(x_i)\\cdot x_i +\\sum_{i=1}^n y_i\\cdot x_i=\\sum_{i=1}^n (y_i\\cdot x_i-p(x_i)\\cdot x_i).\\]\nEndelig kan \\(x_i\\) sættes udenfor parentes, hvorved vi har \\[\\frac{\\partial l(a,b)}{\\partial a}=\\sum_{i=1}^n (y_i-p(x_i))\\cdot x_i.\\]\nFor at lave optimering og finde maksimum, skal vi undersøger, hvornår de partielt afledte er nul. Vi skal således løse følgende to ligninger med to ubekendte \\[\\begin{align*}\n0=\\frac{\\partial l(a,b)}{\\partial a}=\\sum_{i=0}^n (y_i-p(x_i))\\cdot x_i \\quad \\text{og} \\quad 0=\\frac{\\partial l(a,b)}{\\partial b}=\\sum_{i=1}^n (y_i-p(x_i)) .\n\\end{align*}\\] ** ME: Jeg ville skriv \\(=0\\) til sidst…** Dette ligningssystem er dog ikke bare lige til at løse, så her bliver man nødt til at benytte sig af numeriske metoder til løsning af ligningssytemer."
  },
  {
    "objectID": "log-reg.html#multipel-logistisk-regression",
    "href": "log-reg.html#multipel-logistisk-regression",
    "title": "Logistisk regression",
    "section": "Multipel logistisk regression",
    "text": "Multipel logistisk regression\nI praksis er der selvfølgelig flere faktorer end blodtryk, der afgør ens risiko for hjerte-kar-sygdom. For eksempel stiger risikoen med alderen, ligesom rygning øger risikoen. Vi kan opstille en model, der inddrager alle tre variable på en gang. Lader vi \\(x_1\\) betegne blodtryk, \\(x_2\\) betegne alder, og \\(x_3\\) betegne antal cigaretter, man ryger pr. dag, kan vi lave en model, hvor logaritmen til oddsene afhænger af alle tre variable: \\[\n    \\ln \\left ( O(x_1,x_2,x_3)  \\right) = a_1x_1 + a_2x_2 +a_3x_3 + b.\n\\] Nu er der fire ukendte konstanter \\(a_1\\), \\(a_2\\), \\(a_3\\) og \\(b\\) i modellen, som skal bestemmes ud fra data. Dette kaldes den multiple regressionsmodel. Ved at tage eksponentialfunktionen får vi en formel for oddsene \\[\n     O(x_1,x_2,x_3) = e^{a_1x_1 + a_2x_2 +a_3x_3 + b}.\n\\] Man kan også bruge den standard logistiske funktion og få en formel for sandsynligheden \\[\n    p(x_1,x_2,x_3) = \\frac{1}{1+e^{-(a_1x_1 + a_2x_2 +a_3x_3 + b)}}.\n\\]\nHvordan skal vi forstå denne model? Jo, lad os forestille os en patient med alder \\(x_1\\) og blodtryk \\(x_2\\), som ryger \\(x_3\\) cigaretter om dagen. Hvis vedkommende begynder at ryge \\(1\\) cigaret mere om dagen (og vi forestiller os at alder og blodtryk er uændret) så vil odds-ratioen være \\[\n    \\frac{O(x_1,x_2,x_3+1)}{O(x_1,x_2,x_3)} = \\frac{ e^{a_1x_1 + a_2x_2 +a_3(x_3+1) + b}}{e^{a_1x_1 + a_2x_2 +a_3x_3 + b}} =e^{a_3}.\n\\] Den ekstra daglige cigaret vil altså øge odds for sygdom med en faktor \\(e^{a_3}\\). Tilsvarende har \\(e^{a_1}\\) og \\(e^{a_2}\\) fortolkninger som odds-ratioer, når henholdsvis blodtryk og alder stiger med 1, mens alle andre variable fastholdes. Selv om modellen tager alle tre variable i betragtning, giver odds-ratioerne et mål for den individuelle effekt af hver af de tre variable.\nMaximum likelihood metoden kan igen benyttes til at estimere parametrene \\(a_1,a_2,a_3\\) og \\(b\\). Likelihoodfunktionen, som skal maksimeres, bliver nu til en funktion af fire variable. Vi vil ikke gå i detaljer med, hvordan denne maksimering finder sted.\nFramingham datasættet (reference?) er et rigtigt datasæt, der indeholder data for hjerte-kar-sygdom og de tre risikofaktorer \\(x_1\\), \\(x_2\\) og \\(x_3\\). Estimerer man \\(a_1,a_2,a_3\\) og \\(b\\) på dette datasæt, får man \\[\n    O(x_1,x_2,x_3) = e^{0.06x_1 + 0.02x_2 + 0.02x_3 -6.77 }.\n\\] Odds for hjerte-kar-sygdom stiger således med en faktor \\(e^{0.02}\\approx 1.02\\) (altså med 2%), for hver cigaret man ryger om dagen. Tilsvarende stiger odds for sygdom med en faktor \\(e^{0.06}\\approx 1.06\\), for hvert år ældre man bliver, og med en faktor \\(e^{0.02}\\approx 1.02\\), for hver gang blodtrykket stiger med 1 mmHg.\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\nI en multipel regression har man fundet følgende model for odds \\(O(x_1,x_2)\\) for, at en bruger af en hjemmeside klikker på en given reklame, hvor \\(x_1\\) og \\(x_2\\) er antal gange kunden har læst henholdsvis kulturnyheder og sportsnyheder inden for den sidste måned \\[O(x_1,x_2) = e^{-2+0.5x_1-0.1x_2 }.\\]\n\nEn bruger har læst kulturnyheder 4 gange og sportsnyheder 7 gange inden for den sidste måned. Hvad er odds for, at brugeren klikker på reklamen?\nHvad er odds ratioen for kulturnyheder?\nEr sandsynligheden for at klikke på reklamen højere eller lavere blandt brugere, der læser mange kulturnyheder?"
  },
  {
    "objectID": "log-reg.html#prædiktion",
    "href": "log-reg.html#prædiktion",
    "title": "Logistisk regression",
    "section": "Prædiktion",
    "text": "Prædiktion\nNår vi har fundet en god model for sammenhængen mellem sygdom og forskellige risikofaktorer, kan vi bruge den til at forudsige (prædiktere), om en ny patient er syg. Som eksempel kan vi se på den multiple regressionsmodel, hvor risikoen for hjerte-kar-sygdom var givet ved \\[\n    p(x_1,x_2,x_3) = \\frac{1}{1+e^{-(0.06x_1 + 0.02x_2 +0.02x_3 -6.77)}},\n\\] hvor \\(x_1\\) var alderen, \\(x_2\\) var blodtrykket, og \\(x_3\\) var antal cigaretter.\nForestil dig nu, at vi får en ny patient med alderen \\(x_1\\) og blodtrykket \\(x_2\\), som ryger \\(x_3\\) cigaretter om dagen. Vi kan beregne sandsynligheden \\(p(x_1,x_2,x_3)\\) for, at patienten er syg ud fra vores model. Den mest oplagte prædiktionsregel er at prædiktere det mest sandsynlige:\n\nHvis \\(p(x_1,x_2,x_3)&gt;1/2\\): Patienten er syg.\nHvis \\(p(x_1,x_2,x_3)\\leq 1/2\\): Patienten er rask.\n\n** ME: Skrives med gaffelforskrift som tidligere? **\nLad os for eksempel sige, at vores patient er 30 år gammel, har et blodtryk på \\(145\\) mmHg og ryger 7 cigaretter om dagen. Ifølge vores model vil hans risiko for hjerte-kar-sygdom være \\[\n    p(30,145,7) = \\frac{1}{1+e^{-(0.06\\cdot 30 + 0.02\\cdot 145 +0.02\\cdot 7 -6.77)}}\\approx 0.127.\n\\] Hans risiko er på 12.7%. Hvis vi skal lave en prædiktion, vil vi sige, at han er rask, da dette vil være det mest sandsynlige.\nI praksis kan der være et problem med altid at vælge det mest sandsynlige. Hvis man gerne vil kunne forudsige en meget sjælden sygdom, vil det ofte være sådan, at \\(p(x)\\leq 1/2\\) for alle patienter. Ingen ville blive diagnosticeret med sygdommen på denne måde - og så er prædiktionsalgoritmen jo ikke meget værd. Derfor vælger man ofte et lavere delepunkt end \\(p(x)=1/2\\). Dermed kommer man til at fejldiagnosticere en hel del patienter. Til gengæld får man fanget flere af dem, der faktisk er syge. Her kunne man linke til noget om sensitivitet og specificitet i prædiktionssammenhæng\nHer på siden har vi flere eksempler på algoritmer, som vil kunne bruges til at prædiktere om patienter er syge eller raske, fx neurale netværk6 og Bayes klassifikation NOTE:flere?. Fordelen ved at bruge logistisk regression er, at man ikke bare får en prædiktion, men også en model for, hvordan sandsynligheden \\(p(x)\\) afhænger af variablen \\(x\\) ME: Det gør man vel også med Bayes?. Dermed opnår man en indsigt i, hvordan sammenhængen mellem for eksempel blodtryk og hjerte-kar-sygdom er. Ved hjælp af odds-ratioer kan vi endda sætte tal på, hvordan odds for sygdom ændrer sig, når blodtrykket vokser. Dette er i modsætning til mange andre prædiktionsalgoritmer, der blot giver en prædiktion, uden at brugeren af algoritmen ved, hvor den kommer fra. Inden for medicin er det ofte vigtigt at kende baggrunden for en given prædiktion, så man kan forholde sig kritisk til resultatet og rådgive patienten om, hvordan man sænker risikoen for sygdom (for eksempel med blodtrykssænkende medicin). Til gengæld har de mere avancerede algoritmer mulighed for at give en mere præcis prædiktion.\n6 Logistisk regression er i øvrigt et meget simpelt eksempel på et neuralt netværk. ** ME: Hvis man vælge cross entropy tabsfunktionen…?**\nAndre eksempler på anvendelser\nLogistisk regression kan bruges til at modellere meget andet end sygdom. Forestil dig for eksempel en nyhedshjemmeside, der benytter cookies til at målrette reklamer. Hjemmesiden registrerer, hvor mange gange du har læst kulturnyheder \\(x_1\\), og hvor mange gange du har læst sportsnyheder \\(x_2\\) inden for den sidste måned. Desuden registrerer den, om du har klikket på en bestemt reklame for en ny biograffilm. Man kan bruge disse data til at finde en logistisk regressionsmodel for sandsynligheden \\(p(x_1,x_2)\\) for, at en ny bruger klikker på reklamen. Med sådan en model kan man så prædiktere, om en ny bruger vil klikke på reklamen ud fra indsamlet data om brugerens forbrug af sports- og kulturnyheder. Reklamen vil så kun blive vist til brugeren, hvis det prædikteres, at brugeren rent faktisk vil klikke på reklamen.\nEt andet eksempel kunne være en meningsmåling. Et mindre antal vælgere spørges, om de har tænkt sig at stemme på rød eller blå blok. Desuden noteres deres alder \\(x_1\\) og årsindtægt \\(x_2\\). Ud fra dette datasæt laves en model for sandsynligheden \\(p(x_1,x_2)\\) for at stemme på rød blok som funktion af alder og årsindtægt. Ud fra modellen kan man så prædiktere, hvad resten af befolkningen har tænkt sig at stemme.\n\n\n\n\n\n\nOpgaver\n\n\n\n\n\nVi kigger igen på en multipel regressionsmodel for odds \\(O(x_1,x_2)\\) for, at en bruger af en hjemmeside klikker på en given reklame, hvor \\(x_1\\) og \\(x_2\\) er antal gange kunden har læst henholdsvis kulturnyheder og sportsnyheder inden for den sidste måned. Modellen for odds er fundet til \\[O(x_1,x_2) = e^{-2+0.5x_1-0.1x_2 }.\\] Vi vil gerne prædiktere, om en bruger klikker på reklamen, så vi kan beslutte, om det er relevant at vise ham den.\n\nEn bruger har læst kulturnyheder 5 gange og sportsnyheder 8 gange inden for den sidste måned. Vil du prædiktere, at brugeren klikker på reklamen?"
  },
  {
    "objectID": "log-reg.html#sammenhæng-mellem-logistisk-regression-og-logistisk-vækst",
    "href": "log-reg.html#sammenhæng-mellem-logistisk-regression-og-logistisk-vækst",
    "title": "Logistisk regression",
    "section": "Sammenhæng mellem logistisk regression og logistisk vækst",
    "text": "Sammenhæng mellem logistisk regression og logistisk vækst\nHvis du har hørt om logistisk vækst og logistisk regression, spekulerer du måske over, om der er en sammenhæng mellem de to begreber. Vi skal nu se, at der i nogle anvendelser faktisk er en sammenhæng.\nLad os se på et eksempel med en smitsom sygdom, hvor infektionen aldrig forlader kroppen igen, og man kan fortsætte med at smitte andre resten af livet, når først man er blevet smittet. HIV og herpes er eksempler på sådanne sygdomme. Lad \\(I(x)\\) betegne antallet af smittede efter \\(x\\) dage (\\(I\\) står for inficeret). Ifølge den klassiske SI-model, er væksthastigheden for \\(I\\) proportional med både antallet af smittede \\(I(x)\\) og antallet af raske \\(M-I(x)\\), hvor \\(M\\) er det samlede befolkningstal. Det vil sige \\[I'(x) = k I(x)(M-I(x)),\\] hvor \\(k&gt;0\\) er en konstant. Denne ligning kaldes den logistiske differentialligning, og løsningen er givet ved \\[I(x)=\\frac{M}{1+c\\cdot e^{-M\\cdot k\\cdot x}},\\] hvor \\(c&gt;0\\) igen er en konstant, som kan bestemmes, hvis man kender antallet af smittede \\(I(0)\\) til tiden \\(x=0\\). Sætter vi \\(c=\\exp(-b)\\) og \\(a=Mk\\), får vi \\[I(x)=\\frac{M}{1+e^{-b}\\cdot e^{-a\\cdot x}} = \\frac{M}{1+e^{-(a\\cdot x+b)}}.\\] På dag \\(x\\) vil en tilfældigt udvalgt person have en sandsynlighed på \\(p(x)=I(x)/M\\) for at være smittet. Denne sandsynlighed vil være beskrevet af en logistisk funktion \\[p(x)=\\frac{I(x)}{M} = \\frac{1}{1+e^{-(a\\cdot x+b)}}.\\] Dette genkender vi som en logistisk regressionsmodel for sandsynligheden \\(p(x)\\).\nFor at bestemme \\(a\\) og \\(b\\), kunne man derfor lave et datasæt, hvor vi hver dag tager en test af en tilfældig person og ser, om personen er smittet eller rask. Derved får vi et datasæt med punkter \\((x,y)\\), hvor \\(x\\) er antal dage, og \\(y\\) er \\(0\\) hvis personen er rask, eller \\(1\\) hvis personen er smittet. Vi kan nu finde \\(a\\) og \\(b\\) ved at lave logistisk regression på dette datasæt og finde et udtryk for \\(p(x)\\). Hvis vi gerne vil vide, hvor mange der faktisk er syge efter \\(x\\) dage, ganger vi bare sandsynligheden for at være syg op med befolkningstallet \\[I(x)=M\\cdot p(x)=\\frac{M}{1+e^{-(a\\cdot x+b)}}.\\] Det er dog ikke ved alle eksempler, det er muligt at lave denne kobling mellem de to emner. Logistisk vækst vedrører en udvikling i tid, dvs. \\(x\\)-variablen skal angive tid. Desuden skal udviklingen foregå i en population af fast størrelse \\(M\\)."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Logistisk klassifikation/regression",
    "section": "",
    "text": "Logistisk klassifikation/regression\n\nLogistisk klassifikation\nLogistisk regression"
  },
  {
    "objectID": "logklas.html",
    "href": "logklas.html",
    "title": "Logistisk klassifikation",
    "section": "",
    "text": "Lad os forestille os at vi ønsker at se på hvor hurtigt det går før en befolkning får immunitet mod en sygdom. Her tænker vi at det er sådan, at få fra starten af har sygdom/immunitet med at der på et tidspunkt sker en kæmpe udvikling og alle med tiden bliver immune. For at få styr over udvikling kunne man for hver time der går tage en test af en tilfældig person og se om personen er imun eller ikke er imun. Derved får man et datasæt med punkter (x,y) hvor x er tid(dage) og y kunne være 0 svarende til ikke imun eller 1 svarende til imun. Her kunne man forestille sig et datasæt som plottet herunder.\n\n\n\nDatasæt hvor y=1 svarer til imun\n\n\nI stedet for at se på alle personer udtages nogen, og vi kunne være intereseret i på bagrund af datasættet at fastslå hvad sandsynligheden er for at man er imun på et givent tidspunkt. Dette kunne ses som en funktion \\(p(x)\\) som vi derved er interesseret i at få indsigt i. Det er desværre ikke helt så let, og vi bliver nød til at lave nogle antagelser inden vi kan komme med fornuftige forudsigelser.\nVi kunne starte med at se på om en lineær model ville fungere.\n\n\n\nDatasæt med lineær regression og s-formet-funktion\n\n\nDet er tydeligt at det ikke fungerer med en lineær funktion. (mere snak om hvorfor, her også fokus på problem med værdimængde som ikke er mellem 0 og 1).\nVed figuren er der også lagt en s-formet kurve ind med den egenskab at værdimængden er \\(]0,1[\\) som umiddelbart ser mere fornuftig ud.\nIstedet for at se på sandsynligheder direkte kan man se på to andre begreber, nemlig det som betegnes som “odds” som er forholdet mellem sandsynligheder for noget sker i forhold til sandsynligheden for det ikke sker, altså \\[\\frac{p(x)}{1-p(x)}.\\] (note : mere teori om odds)\nDesuden ses på den såkaldte logit-funktion som blot er den naturlige logaritme af odds, altså \\[ln\\left(\\frac{p(x)}{1-p(x)}\\right).\\] Hvis vi her ser dette som en funktion af \\(p(x)\\) med definitionsmængde mellem \\(0\\) og \\(1\\) (\\(p(x)\\) skal jo opfattes som sandsynlighed) ser vi at det giver følgende graf.\n Det er en voksende funktion som derved har en invers, som man kan vise er givet ved \\[\\frac{1}{1+e^{-y}}.\\] Her ses grafen for denne  Denne graf ser mere fornuftig ud i forhold til vores data og den model vi ønsker. Vi kan se at det passer fint med at værdimængden \\(]0,1[\\), men selvfølgelig skulle der være mulighed for justering af hvor hurtig væksten kommer til at blive og en form for vandret forskyd.\nHvis man har en funktion \\(f(x)\\) kan væksten speedes op med en faktor \\(k\\) ved at se på \\(f(k\\cdot x)\\). Hvis man f.eks. ønsker at forskyde med \\(h\\) i \\(x\\)-retningen kan det gøres med funktionen \\(f(k\\cdot (x-h)=f(k\\cdot x-k\\cdot h)\\). Her svarer \\(k\\cdot x-k\\cdot h\\) egentlig bare til en lineær funktion.\nDerved ville det give mening at benytte modellen \\[ln\\left(\\frac{p(x)}{1-p(x)}\\right)=a\\cdot x+b\\] som netop er den model der anvendes ved logistisk klassifikation.\n(evt. mere snak om funktionen \\(\\frac{1}{1+e^{-y}}.\\) : Sigmond og bedre koblinger mellem funktionerne så ideen er mere klar)"
  },
  {
    "objectID": "logklas.html#ideen-bag-logistisk-klassifikation",
    "href": "logklas.html#ideen-bag-logistisk-klassifikation",
    "title": "Logistisk klassifikation",
    "section": "",
    "text": "Lad os forestille os at vi ønsker at se på hvor hurtigt det går før en befolkning får immunitet mod en sygdom. Her tænker vi at det er sådan, at få fra starten af har sygdom/immunitet med at der på et tidspunkt sker en kæmpe udvikling og alle med tiden bliver immune. For at få styr over udvikling kunne man for hver time der går tage en test af en tilfældig person og se om personen er imun eller ikke er imun. Derved får man et datasæt med punkter (x,y) hvor x er tid(dage) og y kunne være 0 svarende til ikke imun eller 1 svarende til imun. Her kunne man forestille sig et datasæt som plottet herunder.\n\n\n\nDatasæt hvor y=1 svarer til imun\n\n\nI stedet for at se på alle personer udtages nogen, og vi kunne være intereseret i på bagrund af datasættet at fastslå hvad sandsynligheden er for at man er imun på et givent tidspunkt. Dette kunne ses som en funktion \\(p(x)\\) som vi derved er interesseret i at få indsigt i. Det er desværre ikke helt så let, og vi bliver nød til at lave nogle antagelser inden vi kan komme med fornuftige forudsigelser.\nVi kunne starte med at se på om en lineær model ville fungere.\n\n\n\nDatasæt med lineær regression og s-formet-funktion\n\n\nDet er tydeligt at det ikke fungerer med en lineær funktion. (mere snak om hvorfor, her også fokus på problem med værdimængde som ikke er mellem 0 og 1).\nVed figuren er der også lagt en s-formet kurve ind med den egenskab at værdimængden er \\(]0,1[\\) som umiddelbart ser mere fornuftig ud.\nIstedet for at se på sandsynligheder direkte kan man se på to andre begreber, nemlig det som betegnes som “odds” som er forholdet mellem sandsynligheder for noget sker i forhold til sandsynligheden for det ikke sker, altså \\[\\frac{p(x)}{1-p(x)}.\\] (note : mere teori om odds)\nDesuden ses på den såkaldte logit-funktion som blot er den naturlige logaritme af odds, altså \\[ln\\left(\\frac{p(x)}{1-p(x)}\\right).\\] Hvis vi her ser dette som en funktion af \\(p(x)\\) med definitionsmængde mellem \\(0\\) og \\(1\\) (\\(p(x)\\) skal jo opfattes som sandsynlighed) ser vi at det giver følgende graf.\n Det er en voksende funktion som derved har en invers, som man kan vise er givet ved \\[\\frac{1}{1+e^{-y}}.\\] Her ses grafen for denne  Denne graf ser mere fornuftig ud i forhold til vores data og den model vi ønsker. Vi kan se at det passer fint med at værdimængden \\(]0,1[\\), men selvfølgelig skulle der være mulighed for justering af hvor hurtig væksten kommer til at blive og en form for vandret forskyd.\nHvis man har en funktion \\(f(x)\\) kan væksten speedes op med en faktor \\(k\\) ved at se på \\(f(k\\cdot x)\\). Hvis man f.eks. ønsker at forskyde med \\(h\\) i \\(x\\)-retningen kan det gøres med funktionen \\(f(k\\cdot (x-h)=f(k\\cdot x-k\\cdot h)\\). Her svarer \\(k\\cdot x-k\\cdot h\\) egentlig bare til en lineær funktion.\nDerved ville det give mening at benytte modellen \\[ln\\left(\\frac{p(x)}{1-p(x)}\\right)=a\\cdot x+b\\] som netop er den model der anvendes ved logistisk klassifikation.\n(evt. mere snak om funktionen \\(\\frac{1}{1+e^{-y}}.\\) : Sigmond og bedre koblinger mellem funktionerne så ideen er mere klar)"
  },
  {
    "objectID": "logklas.html#funktionen-px",
    "href": "logklas.html#funktionen-px",
    "title": "Logistisk klassifikation",
    "section": "Funktionen \\(p(x)\\)",
    "text": "Funktionen \\(p(x)\\)\nVi ved nu at vi arbejder med følgende model \\[ln\\left( \\frac{p(x)}{1-p(x)}\\right) =a\\cdot x+b\\]\nLad os se på hvordan man får et udtryk for \\(p(x)\\). Vi starter med at skifte fortegn på begge sider af lighedstegnet. \\[-ln\\left( \\frac{p(x)}{1-p(x)}\\right) =-a\\cdot x-b.\\] Ved at benytte regnereglen \\(ln(a/b)=ln(a)-ln(b)\\) frem og tilbage på venstresiden sammen med fortegnet fås \\[ln\\left( \\frac{1-p(x)}{p(x)}\\right) =-a\\cdot x-b.\\]\nVed at benytte at \\(e^x\\) er invers til \\(ln(x)\\) fås at \\[\\frac{1-p(x)}{p(x)} =e^{-a\\cdot x-b}\\] Her kan brøken deles op \\[\\frac{1}{p(x)}-1 =e^{-a\\cdot x-b}\\] Her kan vi efter at have adderet med \\(1\\) få isoleret \\(p(x)\\) ved at gange med p(x) og efter følgende dividere med \\(e^{-a\\cdot x-b}\\) hvorved vi ender ud med at \\[{p(x)} =\\frac{1}{1+e^{-a\\cdot x-b}}.\\]\nHvis vi forlænger med \\(e^{a\\cdot x+b}\\) kan \\(p(x)\\) også skrives som \\[{p(x)} =\\frac{e^{a\\cdot xb}}{1+e^{a\\cdot x+b}}.\\]"
  },
  {
    "objectID": "logklas.html#maksimum-likelihood",
    "href": "logklas.html#maksimum-likelihood",
    "title": "Logistisk klassifikation",
    "section": "Maksimum Likelihood",
    "text": "Maksimum Likelihood\nLad os starte med at forstille os at vi allerede kender funktionen \\(p(x)\\). Derved kan vi beregne sandsynligheden for at vi får de givne observationer. Det \\(i\\)’te punkt fra datasættet betegnes med \\((x_i,y_i)\\) og antallet af observationer betegnes med \\(n\\). For en observation \\((x_i,y_i)\\) kender vi tidspunktet(svarende til \\(x\\)-værdien) men \\(y\\)-værdien afhænger af den tilfældigt udvalgte person. Sandsynligheden for at \\(y\\)-værdien antager værdien \\(1\\) er \\(p(x)\\). Derved ved vi også at sandsynlighden for at \\(y\\)-værdien antager værdien \\(0\\) er \\(1-p(x)\\).\nVi antager at der er uafhængighed mellem vores observationerne hvorved sandsynligheder kan ganges sammen. Dette kan skrives ved hjælp af produkt-tegnet hvor vi ved det ene produkt indikerer at vi kun skal benytte de observationer hvor \\(y_i=1\\) og ved den anden kun skal benytte dem hvor \\(y_i=0\\). Vi får følgende sandsynliged, her betegnet med \\(L\\), hørende til vores datasæt \\[ L=\\prod_{i : y_{i}=1} p(x_i)\\cdot \\prod_{i : y_{i}=0} (1-p(x_i)).\\] (note med læsning af \\(i:y_i=1\\)).\nVed en model skal det selvfølgelig være sådan at den er tilpasset sådan at dette udtryk er størst muligt da modellen derved forudsiger at det observerede datasæt er mest sandsynligt.\nIstedet for at se på netop dette udtryk tages \\(ln\\) af udtrykket. Ved at benytte at \\(ln(a\\cdot b)=ln(a)+ln(b)\\) adskillige gange får vi at \\[ln(L)=\\sum_{i : y_{i}=1} ln(p(x_i))+\\sum_{i : y_{i}=0} ln(1-p(x_i))\\] Da funktion \\(f(x)=ln(x)\\) er en voksende funktion, vil en optimering af \\(ln(L)\\) og \\(L\\) være det samme.\nNu ønsker vi egentlig at få udtrykyt \\(L\\) hvor vi kun benytter en sum istedet for to. Til dette indser vi lige at \\[\n\\begin{array}{cc}\n  p(x_i)^{y_i}= &  \n    \\begin{array}{cc}\n      1 & hvis\\quad  y_i= 0 \\\\\n      p(x_i) & hvis\\quad  y_i= 1\n    \\end{array}\n\\end{array}\n\\] og \\[\n\\begin{array}{cc}\n  (1-p(x_i))^{1-y_i}= &  \n    \\begin{array}{cc}\n      (1-p(x_i)) & hvis\\quad  y_i= 0 \\\\\n      1 & hvis\\quad  y_i= 1\n    \\end{array}\n\\end{array}\n\\] Ved et produkt med flere faktorer har en faktor \\(1\\) selvfølgelig ikke nogen betydning, og vi får at \\(L\\) kan skrives som \\[ L=\\prod_{i}^n p(x_i)^{y_i}\\cdot (1-p(x_i))^{1-y_i}.\\] Ved at benytte at \\(ln(a\\cdot b)=ln(a)+ln(b)\\) og \\(ln(a^k)=k\\cdot ln(a)\\) adskillige gange får vi at \\[ ln(L)=\\sum_{i=1}^n {y_i}\\cdot ln(p(x_i))+(1-y_i)\\cdot ln(1-p(x_i)).\\] Ved at ophæve parentesen fås \\[ ln(L)=\\sum_{i=1}^n {y_i}\\cdot ln(p(x_i))+ln(1-p(x_i))- y_i\\cdot ln(1-p(x_i)).\\]\nI to af ledene indenfor sumtegnet har vi \\(y_i\\) som en faktor, og \\(y_i\\) sættes udenfor parentes \\[ ln(L)=\\sum_{i}^n ln(1-p(x_i))+{y_i}\\cdot (ln(p(x_i))-ln(1-p(x_i))).\\] Ved hjælp af logaritme-regnereglen \\(ln(a/b)=ln(a)-ln(b)\\) får vi\n\\[ ln(L)=\\sum_{i=1}^n ln(1-p(x_i))+y_i\\cdot ln\\left(\\frac{p(x_i)}{1-p(x_i)}\\right).\\]\nHer opsplitter vi til to summer hvor den ene ikke afhænger af \\(y_i\\). \\[ ln(L)=\\sum_{i=1}^n ln(1-p(x_i))+\\sum_{i=1} y_i\\cdot ln\\left(\\frac{p(x_i)}{1-p(x_i)}\\right).\\]"
  },
  {
    "objectID": "logklas.html#maksimum-likelihood-med-valgt-px",
    "href": "logklas.html#maksimum-likelihood-med-valgt-px",
    "title": "Logistisk klassifikation",
    "section": "Maksimum Likelihood med valgt \\(p(x)\\)",
    "text": "Maksimum Likelihood med valgt \\(p(x)\\)\nNu har vi fået styr over udtrykket for likelihood, og vi har fundet et udtryk for \\(p(x)\\) ved den valgte model. Dog afhænger \\(p(x)\\) stadigvæk af valget af \\(a\\) og \\(b\\) hvorved \\(L\\) også kommer til at afhænge deraf, og vil derfor noteres som \\(L(a,b)\\) i det følgende.\nVed at kombinere ligningerne ??? får vi at\n\\[ ln(L(a,b))=\\sum_{i=1}^n ln\\left(1-\\frac{e^{a\\cdot x_i+ b}}{1+e^{a\\cdot x_i+b}}\\right)+\\sum_{i=1} y_i\\cdot (ax_i+b).\\] Udtrykket i logaritmen laves om til en samlet brøk\n\\[ ln(L(a,b))=\\sum_{i=1}^n ln\\left(\\frac{1}{1+e^{a\\cdot x_i+b}}\\right)+\\sum_{i=1} y_i\\cdot (ax_i+b).\\] Her benytter vi igen regnereglen \\(ln(a-b)=ln(a)-ln(b)\\). \\[ ln(L(a,b))=\\sum_{i=1}^n ln(1)-ln(1+e^{a\\cdot x_i+b})+\\sum_{i=1} y_i\\cdot (ax_i+b).\\] Da \\(ln(1)=0\\) har vi endelig \\[ ln(L(a,b))=\\sum_{i=1}^n -ln(1+e^{a\\cdot x_i+b})+\\sum_{i=1} y_i\\cdot (ax_i+b).\\]"
  },
  {
    "objectID": "logklas.html#optimering",
    "href": "logklas.html#optimering",
    "title": "Logistisk klassifikation",
    "section": "Optimering",
    "text": "Optimering\nFor at finde et minimum for \\(L(a,b)\\) eller \\(ln(L(a,b))\\) kan vi selffølgelige finde stationære punkter ved at sætte de partiel afledte lig \\(0\\).\nLad os først se på \\(\\frac{\\partial l(a,b)}{\\partial b}\\). Ved den første skal vi se udtrykket som en sammensat funktion hvor den indre funktion har et led som også er en sammensat funktion.\n\\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{1}{1+e^{a\\cdot x_i+b}}\\cdot (0+e^{a\\cdot x_i+b})\\cdot(0\\cdot x_i+1)) +\\sum_{i=1} y_i\\cdot (1\\cdot 0+1)\\] Ved at reducere fås \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{e^{a\\cdot x_i+b}}{1+e^{a\\cdot x_i+b}} +\\sum_{i=1} y_i\\] Ved at bruge ligning ?? i forbindelse med den første sum kan dette omskrives til \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -p(x_i) +\\sum_{i=1} y_i=\\sum_{i=1}^n y_i-p(x_i).\\]\nNu ser vi på \\(\\frac{\\partial l(a,b)}{\\partial a}\\). på tilsvarende måde. \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{1}{1+e^{a\\cdot x_i+b}}\\cdot (0+e^{a\\cdot x_i+b})\\cdot(1\\cdot x_i+0)) +\\sum_{i=1} y_i\\cdot (1\\cdot x_i+0)\\] Der reduceres \\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -\\frac{e^{a\\cdot x_i+b}}{1+e^{a\\cdot x_i+b}}\\cdot x_i +\\sum_{i=1} y_i\\cdot x_i.\\]\nIgen bruges ligning ?? til at få\n\\[\\frac{\\partial l(a,b)}{\\partial b}= \\sum_{i=1}^n -p(x_i)\\cdot x_i +\\sum_{i=1} y_i\\cdot x_i=\\sum_{i=0}^n y_i\\cdot x_i-p(x_i)\\cdot x_i.\\]\nEndelig kan \\(x_i\\) sættes udenfor parentes hvorved vi har \\[\\frac{\\partial l(a,b)}{\\partial b}=\\sum_{i=0}^n (y_i-p(x_i))\\cdot x_i.\\] For at lave optimering og finde minimum skal vi derved løse følgende to ligninger med to ubekendte \\[0=\\sum_{i=0}^n (y_i-p(x_i))\\cdot x_i \\quad \\text{og} \\quad 0=\\sum_{i=1}^n y_i-p(x_i).\\] Dette ligningssystem er dog ikke bare lige til at løse, så enten skal man igang med at benytte numeriske metoder til løsninger af dette eller benytte sig af gradient nedstigning (reference) for at få det optimale bund på parametrene \\(a\\) og \\(b\\) som fastlægger funktionen \\(p(x)\\)."
  },
  {
    "objectID": "logklas.html#prediktion-og-relation-til-logistisk-udvikling",
    "href": "logklas.html#prediktion-og-relation-til-logistisk-udvikling",
    "title": "Logistisk klassifikation",
    "section": "Prediktion og Relation til logistisk udvikling",
    "text": "Prediktion og Relation til logistisk udvikling\nNår man endelig har fået fastlagt parametrene \\(a\\) og \\(b\\) kan vi endelig få vores model \\(p(x)\\) ud fra.\n(mabgler alt med prædiktion og om man skal forudsige \\(y=1\\) eller \\(y=0\\))\nMan kan selvfølgelig tænke over om ovenstående skulle have relation til logistisk vækst. Hvis man fra logistisk klassifikation kommer frem til funktionen \\(p(x)\\) \\[{p(x)} =\\frac{1}{1+e^{-a\\cdot x-b}}.\\] Vi husker at det var denne funktionen som forudsiger sandsynligheden for \\(y=1\\).\nSå f.eks. ved eksemplet med imun/ikke imun kan man forudsige hvad sandsynligheden er for at en tilfældig person er imun efter 100 dage ved at beregne\n\\[{p(100)} =\\frac{1}{1+e^{-a\\cdot 100-b}}.\\]\nDet kan selvfølgelig være at man ikke er interesseret i en person men istedte ønsker et bud på hvor mange der faktisk er imune blandt hele befolkningen med \\(M\\) personer. Hvis \\(f(x)\\) er antal imune efter \\(x\\) dage må det være oplagt at benytte modellen\n\\[f(x)=M\\cdot p(x)=\\frac{M}{1+e^{-a\\cdot x-b}}.\\] Ved \\(a\\) kan vi lige gange og dividere med \\(M\\) og kalde \\(a/M\\) for \\(a_{ny}\\). Derved er \\[f(x)=M\\cdot p(x)=\\frac{M}{1+e^{-M\\cdot a_{ny}\\cdot x-b}}=\\frac{M}{1+e^{-M\\cdot a_{ny}\\cdot x-b}}.\\] Ved at benytte potensregneregel får vi \\[f(x)=M\\cdot p(x)=\\frac{M}{1+e^{-M\\cdot a_{ny}\\cdot x-b}}=\\frac{M}{1+e^{-b}\\cdot e^{-M\\cdot a_{ny}\\cdot x}}.\\] Hvis vi kalder \\(e^{-b}\\) for \\(c\\) får vi \\[f(x)=M\\cdot p(x)=\\frac{M}{1+e^{-M\\cdot a_{ny}\\cdot x-b}}=\\frac{M}{1+c\\cdot e^{-M\\cdot a_{ny}\\cdot x}}.\\] Som netop svarer til den kendte formel hørende til logistisk vækst og løsningen af differentialligningen \\[y'=a\\cdot y\\cdot(M-y)\\]."
  }
]